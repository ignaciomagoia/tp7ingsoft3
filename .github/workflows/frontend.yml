name: Frontend CI/CD

on:
  push:
    branches: ["main", "develop"]
  pull_request:
    branches: ["main", "develop"]

jobs:
  test-frontend:
    name: Test frontend
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash
        working-directory: frontend

    steps:
      # Fetch the repository contents.
      - name: Checkout repository
        uses: actions/checkout@v4

      # Install Node.js 22.x with npm caching enabled.
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "22.x"
          cache: "npm"
          cache-dependency-path: frontend/package-lock.json

      # Install dependencies in a clean, reproducible way.
      - name: Install dependencies
        run: npm ci

      # Run Jest tests with coverage enabled.
      - name: Run tests with coverage
        run: npm test -- --coverage --watchAll=false

      # Show coverage summary (lines, functions, branches) from Jest output.
      - name: Display coverage summary
        run: |
          node -e "const summary=require('./coverage/coverage-summary.json').total; console.log('Lines:', summary.lines.pct + '%'); console.log('Functions:', summary.functions.pct + '%'); console.log('Branches:', summary.branches.pct + '%'); console.log('Statements:', summary.statements.pct + '%');"

      # Upload the HTML coverage report generated by Jest.
      - name: Upload coverage artifact
        uses: actions/upload-artifact@v4
        with:
          name: frontend-coverage-report
          path: frontend/coverage/lcov-report

      # Print the path to the HTML report for quick access.
      - name: Print coverage report path
        run: echo "Coverage report available at frontend/coverage/lcov-report/index.html"
